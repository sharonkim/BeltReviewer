<h2>Welcome, <%= current_user.first_name %></h2>

<% if flash[:errors] %>
	<% flash[:errors].each do |e| %>
		<p><%= e %></p>
	<% end %>
<% end %>

<h3>Here are some of the events in your state:</h3>
<table class="in_state">
	<thead>
		<th>Name</th>
		<th>Date</th>
		<th>Location</th>
		<th>Host</th>
		<th>Action/Status</th>
	</thead>
	<tbody>
		<% @local_events.each do |event| %>
			<tr>
				<td><a href="/events/<%= event.id %>"><%= event.name %></a></td>
				<td><%= event.date %></td>
				<td><%= event.location %></td>
				<td><%= event.user.first_name %> <%= event.user.last_name %></td>
				<td>
					<% if event.user == current_user %>
						<a href="/events/<%= event.id %>/edit">Edit &emsp; </a>
						<a href="/events/<%= event.id %>/destroy" data-method="delete">Delete</a>
					<% elsif current_user.attending.exists?(event.id) %> Joining &ensp;
						<a href="/participants/<%= event.id %>/destroy" data-method="delete">Cancel</a>
					<% else %>
						<a href="/participants/<%= event.id %>/create" data-method="post">Join &emsp; </a>
					<% end %>
				</td>
					<% if @user.id == event.user_id %>
						<input type="hidden" name="_method" value="patch">
						<input type="hidden" name="_method" value="delete">
						<input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
						<td>
							<a href="/events/<%= event.id %>/edit">Edit &emsp14; </a>
							<a href="/events<%= event.id %>"data-method="delete">Delete</a>
					<% else %>
						<td>
							<form action="/events/<%= event.id %>/join" method="post">
								<input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
								<input type="hidden" name="event[user_id]" value="<%= user.id %>">
								<a href="/events/<%= event.id %>/join %> data-method="post"">Join &emsp;</a>
						</td>
					<% end %>
				</form>
			</tr>
		<% end %>
	</tbody>
</table>

<h3>Here are some of the events in other states:</h3>
<table class="other_states">
	<thead>
		<th>Name</th>
		<th>Date</th>
		<th>Location</th>
		<th>State</th>
		<th>Host</th>
		<th>Action/Status</th>
	</thead>
	<tbody>
		<% @other_events.each do |event| %>
			<tr>
				<td>
					<a href="/events/<%= event.id %>"><%= event.name %></a>
				</td>
				<td><%= event.date %></td>
				<td><%= event.location %></td>
				<td><%= event.state %></td>
				<td><%= event.user.first_name %></td>
				<td>
					<%if event.user == current_user%>
						<a href="/events/<%= event.id %>/edit">Edit</a>
						<a href="/events/<%= event.id %>/destroy">Delete</a>
				</td>

				<% if @user.id == event.user_id %>
					<td>
						<a href="/events/<%= event.id %>/edit">Edit</a> &emsp14; <a href="/events/<%= event.id %>" data-method="delete">Delete</a>
				<% elsif current_user.attending.exists?(event.id) %> Joining
					<a href="/participants/<%= event.id %>/destroy">Cancel</a>
					</td>
					<td>
						<form action="/events/<%= event.id %>/join" method="post">
							<input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
							<input type="hidden" name="event[user_id]" value="<%= user.id %>">
							<a href="/events/<%= event.id %>/join %>">Join</a>
						</form>
					</td>
				<% end %>
			</tr>
				<% end %>
			<% end %>
		<% end %>
	</tbody>
</table>

<h3>Add Event</h3>
<form action="/events/create" method="post">
	<input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
	<p>Name: <input type="text" name="name" placeholder="Event Name" required></p>
	<p>Date: <input type="date" name="date" required></p>
	<p>Location: <input type="text" name="city" placeholder="Location of event" required>
	<select name="state">
		<% CS.states(:us).each |state| %>
			<option value="<%= state %>">AK</option>
		<% end %>
	</select></p>
	<input type="submit" value="Add Event">
</form>

<a href="/users/<%= @user.id %>/edit">Edit Profile</a> &emsp14; <a href="/logout">Logout</a>
